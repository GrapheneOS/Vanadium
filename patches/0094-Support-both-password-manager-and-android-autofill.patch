From 2966f6345acb85eb1c91e2beb8197f857202ef03 Mon Sep 17 00:00:00 2001
From: fgei <fgei@gmail.com>
Date: Mon, 20 Feb 2023 07:06:53 +0000
Subject: [PATCH] Support both password manager and android autofill

---
 .../autofill/content/renderer/password_autofill_agent.cc    | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/components/autofill/content/renderer/password_autofill_agent.cc b/components/autofill/content/renderer/password_autofill_agent.cc
index 17c54ee3590a3..2b740d9f0cdd9 100644
--- a/components/autofill/content/renderer/password_autofill_agent.cc
+++ b/components/autofill/content/renderer/password_autofill_agent.cc
@@ -1129,6 +1129,12 @@ bool PasswordAutofillAgent::ShowSuggestions(
   // Touch To Fill in spirit is very similar to a suggestion pop-up, return true
   // so that the AutofillAgent does not try to show other autofill suggestions
   // instead.
+  if (HasDocumentWithValidFrame(element) && IsKeyboardAccessoryEnabled()) {
+    ShowSuggestionPopup(element.Value().Utf16(), element, show_all,
+                        OnPasswordField(false));
+    return false;
+  }
+
   if (touch_to_fill_state_ == TouchToFillState::kIsShowing)
     return true;
 #endif
