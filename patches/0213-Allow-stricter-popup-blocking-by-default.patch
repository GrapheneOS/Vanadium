From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: fgei <88831734+quh4gko8@users.noreply.github.com>
Date: Tue, 26 Aug 2025 03:46:51 +0000
Subject: [PATCH] Allow stricter popup blocking by default

---
 components/blocked_content/popup_blocker.cc | 5 +++++
 components/embedder_support/switches.cc     | 3 +++
 components/embedder_support/switches.h      | 1 +
 3 files changed, 9 insertions(+)

diff --git a/components/blocked_content/popup_blocker.cc b/components/blocked_content/popup_blocker.cc
index 8b12c7dd441f3..2c618a927e665 100644
--- a/components/blocked_content/popup_blocker.cc
+++ b/components/blocked_content/popup_blocker.cc
@@ -81,6 +81,11 @@ PopupBlockType ShouldBlockPopup(content::WebContents* web_contents,
     return PopupBlockType::kNotBlocked;
   }
 
+  if (!base::CommandLine::ForCurrentProcess()->HasSwitch(
+          embedder_support::kDisableStrictPopupBlocking)) {
+    return PopupBlockType::kAbusive;
+  }
+
   auto* safe_browsing_blocker =
       SafeBrowsingTriggeredPopupBlocker::FromWebContents(web_contents);
   if (safe_browsing_blocker &&
diff --git a/components/embedder_support/switches.cc b/components/embedder_support/switches.cc
index f6845d728cb5c..4d6595e3eba2c 100644
--- a/components/embedder_support/switches.cc
+++ b/components/embedder_support/switches.cc
@@ -12,6 +12,9 @@ const char kDisableAutoReload[] = "disable-auto-reload";
 // Disables pop-up blocking.
 const char kDisablePopupBlocking[] = "disable-popup-blocking";
 
+// Disables strict pop-up blocking.
+const char kDisableStrictPopupBlocking[] = "disable-strict-popup-blocking";
+
 // Enable auto-reload of error pages.
 const char kEnableAutoReload[] = "enable-auto-reload";
 
diff --git a/components/embedder_support/switches.h b/components/embedder_support/switches.h
index 088dc9271bbb5..5dc57aaa6e7c5 100644
--- a/components/embedder_support/switches.h
+++ b/components/embedder_support/switches.h
@@ -13,6 +13,7 @@ namespace embedder_support {
 
 extern const char kDisableAutoReload[];
 extern const char kDisablePopupBlocking[];
+extern const char kDisableStrictPopupBlocking[];
 extern const char kEnableAutoReload[];
 extern const char kHeadless[];
 extern const char kOriginTrialDisabledFeatures[];
