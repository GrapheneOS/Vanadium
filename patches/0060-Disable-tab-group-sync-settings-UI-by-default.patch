From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: quh4gko8 <88831734+quh4gko8@users.noreply.github.com>
Date: Tue, 29 Apr 2025 16:16:10 +0000
Subject: [PATCH] Disable tab group sync settings UI by default

---
 .../chrome/browser/tasks/tab_management/TabsSettings.java  | 5 ++++-
 chrome/browser/flags/android/chrome_feature_list.cc        | 1 +
 .../chromium/chrome/browser/flags/ChromeFeatureList.java   | 2 ++
 components/saved_tab_groups/public/features.cc             | 7 +++++++
 components/saved_tab_groups/public/features.h              | 2 ++
 5 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/chrome/android/features/tab_ui/java/src/org/chromium/chrome/browser/tasks/tab_management/TabsSettings.java b/chrome/android/features/tab_ui/java/src/org/chromium/chrome/browser/tasks/tab_management/TabsSettings.java
index bdd0f02ce4e7d..0d1aff49c3da7 100644
--- a/chrome/android/features/tab_ui/java/src/org/chromium/chrome/browser/tasks/tab_management/TabsSettings.java
+++ b/chrome/android/features/tab_ui/java/src/org/chromium/chrome/browser/tasks/tab_management/TabsSettings.java
@@ -19,6 +19,7 @@ import org.chromium.chrome.R;
 import org.chromium.chrome.browser.auxiliary_search.AuxiliarySearchConfigManager;
 import org.chromium.chrome.browser.auxiliary_search.AuxiliarySearchControllerFactory;
 import org.chromium.chrome.browser.auxiliary_search.AuxiliarySearchUtils;
+import org.chromium.chrome.browser.flags.ChromeFeatureList;
 import org.chromium.chrome.browser.preferences.ChromeSharedPreferences;
 import org.chromium.chrome.browser.preferences.Pref;
 import org.chromium.chrome.browser.settings.ChromeBaseSettingsFragment;
@@ -80,7 +81,9 @@ public class TabsSettings extends ChromeBaseSettingsFragment {
         ChromeSwitchPreference autoOpenSyncedTabGroupsSwitch =
                 (ChromeSwitchPreference) findPreference(PREF_AUTO_OPEN_SYNCED_TAB_GROUPS_SWITCH);
         boolean isTabGroupSyncAutoOpenConfigurable =
-                TabGroupSyncFeatures.isTabGroupSyncEnabled(getProfile());
+                TabGroupSyncFeatures.isTabGroupSyncEnabled(getProfile())
+                        && ChromeFeatureList.isEnabled(
+                                ChromeFeatureList.TAB_GROUP_SYNC_AUTO_OPEN_KILL_SWITCH);
         if (!isTabGroupSyncAutoOpenConfigurable) {
             autoOpenSyncedTabGroupsSwitch.setVisible(false);
             return;
diff --git a/chrome/browser/flags/android/chrome_feature_list.cc b/chrome/browser/flags/android/chrome_feature_list.cc
index 2bfb9c48f17f6..48a030bd7774c 100644
--- a/chrome/browser/flags/android/chrome_feature_list.cc
+++ b/chrome/browser/flags/android/chrome_feature_list.cc
@@ -516,6 +516,7 @@ const base::Feature* const kFeaturesExposedToJava[] = {
     &syncer::kSyncEnablePasswordsSyncErrorMessageAlternative,
     &syncer::kUnoPhase2FollowUp,
     &syncer::kWebApkBackupAndRestoreBackend,
+    &tab_groups::kTabGroupSyncAutoOpenKillSwitch,
     &tab_groups::kUseAlternateHistorySyncIllustration,
     &visited_url_ranking::features::kGroupSuggestionService,
     &visited_url_ranking::features::kVisitedURLRankingService,
diff --git a/chrome/browser/flags/android/java/src/org/chromium/chrome/browser/flags/ChromeFeatureList.java b/chrome/browser/flags/android/java/src/org/chromium/chrome/browser/flags/ChromeFeatureList.java
index 3ff509435cb1f..1e4f875923e27 100644
--- a/chrome/browser/flags/android/java/src/org/chromium/chrome/browser/flags/ChromeFeatureList.java
+++ b/chrome/browser/flags/android/java/src/org/chromium/chrome/browser/flags/ChromeFeatureList.java
@@ -658,6 +658,8 @@ public abstract class ChromeFeatureList {
     public static final String TAB_GROUP_ENTRY_POINTS_ANDROID = "TabGroupEntryPointsAndroid";
     public static final String TAB_GROUP_PARITY_BOTTOM_SHEET_ANDROID =
             "TabGroupParityBottomSheetAndroid";
+    public static final String TAB_GROUP_SYNC_AUTO_OPEN_KILL_SWITCH =
+            "TabGroupSyncAutoOpenKillSwitch";
     public static final String TAB_MODEL_INIT_FIXES = "TabModelInitFixes";
     public static final String TAB_STORAGE_SQLITE_PROTOTYPE = "TabStorageSqlitePrototype";
     public static final String TAB_STRIP_AUTO_SELECT_ON_CLOSE_CHANGE =
diff --git a/components/saved_tab_groups/public/features.cc b/components/saved_tab_groups/public/features.cc
index 58df956d77020..b9cc7a3c28ff0 100644
--- a/components/saved_tab_groups/public/features.cc
+++ b/components/saved_tab_groups/public/features.cc
@@ -22,6 +22,13 @@ constexpr char kGroupCleanUpTimeIntervalInSecondsFinchKey[] =
 // Noop when disabled.
 BASE_FEATURE(kTabGroupSyncDelegateAndroid, base::FEATURE_ENABLED_BY_DEFAULT);
 
+// Feature flag to disable auto-open of saved tab groups. Note that the
+// settings page for auto open will still be visible, and when user is allowed
+// to change. However the written pref from the user selection will not be
+// honored. This feature flag should be used only in case of an emergency.
+BASE_FEATURE(kTabGroupSyncAutoOpenKillSwitch,
+             base::FEATURE_DISABLED_BY_DEFAULT);
+
 // Feature flag to restrict download on synced tabs if the navigation is
 // triggered without attention..
 BASE_FEATURE(kRestrictDownloadOnSyncedTabs, base::FEATURE_ENABLED_BY_DEFAULT);
diff --git a/components/saved_tab_groups/public/features.h b/components/saved_tab_groups/public/features.h
index eded76853ca04..590420ce02fe7 100644
--- a/components/saved_tab_groups/public/features.h
+++ b/components/saved_tab_groups/public/features.h
@@ -16,6 +16,8 @@ BASE_DECLARE_FEATURE(kTabGroupsSaveV2);
 
 BASE_DECLARE_FEATURE(kTabGroupSyncDelegateAndroid);
 
+BASE_DECLARE_FEATURE(kTabGroupSyncAutoOpenKillSwitch);
+
 BASE_DECLARE_FEATURE(kRestrictDownloadOnSyncedTabs);
 
 BASE_DECLARE_FEATURE(kUseAlternateHistorySyncIllustration);
