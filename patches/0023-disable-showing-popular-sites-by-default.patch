From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Daniel Micay <danielmicay@gmail.com>
Date: Tue, 6 Mar 2018 00:27:41 -0500
Subject: [PATCH] disable showing popular sites by default

---
 components/ntp_tiles/features.cc           | 2 +-
 components/ntp_tiles/most_visited_sites.cc | 4 ++++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/components/ntp_tiles/features.cc b/components/ntp_tiles/features.cc
index ad99eb2ce208f..b8cb2f180fd82 100644
--- a/components/ntp_tiles/features.cc
+++ b/components/ntp_tiles/features.cc
@@ -15,7 +15,7 @@ const char kPopularSitesFieldTrialName[] = "NTPPopularSites";
 
 BASE_FEATURE(kPopularSitesBakedInContentFeature,
              "NTPPopularSitesBakedInContent",
-             base::FEATURE_ENABLED_BY_DEFAULT);
+             base::FEATURE_DISABLED_BY_DEFAULT);
 
 BASE_FEATURE(kNtpMostLikelyFaviconsFromServerFeature,
              "NTPMostLikelyFaviconsFromServer",
diff --git a/components/ntp_tiles/most_visited_sites.cc b/components/ntp_tiles/most_visited_sites.cc
index 3adb8ecd37d96..73da0a97054b0 100644
--- a/components/ntp_tiles/most_visited_sites.cc
+++ b/components/ntp_tiles/most_visited_sites.cc
@@ -260,9 +260,11 @@ void MostVisitedSites::AddMostVisitedURLsObserver(Observer* observer,
   if (!is_observing_) {
     is_observing_ = true;
     if (popular_sites_ && NeedPopularSites(prefs_, GetMaxNumSites())) {
+#if defined(ENABLE_POPULAR_SITES)
       popular_sites_->MaybeStartFetch(
           false, base::BindOnce(&MostVisitedSites::OnPopularSitesDownloaded,
                                 base::Unretained(this)));
+#endif // defined(ENABLE_POPULAR_SITES)
     }
 
     if (top_sites_) {
@@ -631,6 +633,7 @@ MostVisitedSites::CreatePopularSitesSections(
     return sections;
   }
 
+#if defined(ENABLE_POPULAR_SITES)
   const std::set<std::string> no_hosts;
   for (const auto& section_type_and_sites : popular_sites()->sections()) {
     SectionType type = section_type_and_sites.first;
@@ -648,6 +651,7 @@ MostVisitedSites::CreatePopularSitesSections(
                                   /*num_max_tiles=*/GetMaxNumSites());
     }
   }
+#endif // defined(ENABLE_POPULAR_SITES)
   return sections;
 }
 
